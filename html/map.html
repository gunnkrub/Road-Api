<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>Station Locations</title>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script src="https://cdn.rawgit.com/mapbox/wellknown/master/wellknown.js"></script>
<body>
  <div id="chart" style="width:100vw;height:100vh;"></div>
  <script>
    async function createChart() {
      var resp = await fetch('http://localhost:3000/graphql', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Accept': 'application/json',
        },
        body: JSON.stringify({
          query: `
            {basins {
                name
                geom
  		stations{
                  name
                  lat
                  lon
                }
            }}`
        })
      });
      var json = await resp.json();
      var table = json.data;
      var data = [
        {
          type: "scattermapbox",
          text: table.basins[0].stations.map(row => row.name),
          lon: table.basins[0].stations.map(row => row.lon),
          lat: table.basins[0].stations.map(row => row.lat),
          marker: { color: "black", size: 10 },
        },
	{
          type: "scattermapbox",
          text: table.basins[1].stations.map(row => row.name),
          lon: table.basins[1].stations.map(row => row.lon),
          lat: table.basins[1].stations.map(row => row.lat),
          marker: { color: "black", size: 10 },
        },
	{
          type: "scattermapbox",
          text: table.basins[2].stations.map(row => row.name),
          lon: table.basins[2].stations.map(row => row.lon),
          lat: table.basins[2].stations.map(row => row.lat),
          marker: { color: "black", size: 10 },
        },
	{
          type: "scattermapbox",
          text: table.basins[3].stations.map(row => row.name),
          lon: table.basins[3].stations.map(row => row.lon),
          lat: table.basins[3].stations.map(row => row.lat),
          marker: { color: "black", size: 10 },
        },
	{
          type: "scattermapbox",
          text: table.basins[4].stations.map(row => row.name),
          lon: table.basins[4].stations.map(row => row.lon),
          lat: table.basins[4].stations.map(row => row.lat),
          marker: { color: "black", size: 10 },
        },
      ];

      var layout = {
        dragmode: "zoom",
        showlegend: false,
        mapbox: {
          style: "open-street-map",
          center: { lat: 17.16, lon: 99.86 },
          zoom: 6,
          layers: [
            {
              source: {
                type: "Feature",
                geometry: wellknown.parse(table.basins[0].geom)
              },
              type: "fill", color: "red", opacity: 0.2,
            },
	    {
              source: {
                type: "Feature",
                geometry: wellknown.parse(table.basins[1].geom)
              },
              type: "fill", color: "blue", opacity: 0.2,
            },
	    {
              source: {
                type: "Feature",
                geometry: wellknown.parse(table.basins[2].geom)
              },
              type: "fill", color: "yellow", opacity: 0.2,
            },
	    {
              source: {
                type: "Feature",
                geometry: wellknown.parse(table.basins[3].geom)
              },
              type: "fill", color: "cyan", opacity: 0.2,
            },
	    {
              source: {
                type: "Feature",
                geometry: wellknown.parse(table.basins[4].geom)
              },
              type: "fill", color: "purple", opacity: 0.2,
            },
          ]
        },
        margin: { r: 0, t: 0, b: 0, l: 0 }
      };

      var config = { responsive: true };
      Plotly.newPlot("chart", data, layout, config);
    }

    createChart();
  </script>
</body>
</html>
